define("wixCodeInit",["lodash","coreUtils","experiment","platformInit","host-platform-api"],function(e,t,r,n,o){return function(e){var t={};function r(n){if(t[n])return t[n].exports;var o=t[n]={i:n,l:!1,exports:{}};return e[n].call(o.exports,o,o.exports,r),o.l=!0,o.exports}return r.m=e,r.c=t,r.d=function(e,t,n){r.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},r.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.t=function(e,t){if(1&t&&(e=r(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(r.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var o in e)r.d(n,o,function(t){return e[t]}.bind(null,o));return n},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="",r(r.s=1389)}({0:function(t,r){t.exports=e},1:function(e,r){e.exports=t},1389:function(e,t,r){var n,o;n=[r(1390),r(1393),r(34)],void 0===(o=function(e,t,r){"use strict";return{getAppApi:e.getApi,initMainR:t,appsUtils:r.appsUtils,specMapUtils:r.specMapUtils,registerDeps:r.registerDeps}}.apply(t,n))||(e.exports=o)},1390:function(e,t,r){var n,o;n=[r(0),r(34),r(1),r(1391),r(1392),r(65)],void 0===(o=function(e,t,r,n,o,i){"use strict";var a=r.urlUtils,s=a.parseUrl,d=a.isQueryParamOn;var c=function(t){var r=[];return e(t).filter("controllerScriptMap").forEach(function(t){e.forEach(t.controllerScriptMap,function(e,n){r.push({id:n,url:e,appDefinitionId:t.id,isControllerScript:!0})})}),r};function p(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},o=arguments[2],i=!!t.publicModel,a="undefined"!=typeof window&&!window.clientSideRender,p="undefined"==typeof window||window.isPseudoWindow,l=t.wixBiSession,f=l.viewerSessionId,m=l.visitorId,g=l.initialTimestamp,w=l.initialRequestTimestamp,v=l.siteMemberId,S=l.random,M=l.coin,x=l.pn,y=l.requestId,b=t.rendererModel,h=b.metaSiteId,I=b.userId,C=s(n.currentUrl);n.applications=n.applications||[];var A,P=c(n.applications),U=n.applications.concat(P),k={biSessionData:{metaSiteId:h,viewerSessionId:f,visitorId:m,siteMemberId:v,requestId:y,ownerId:I,pageLoadStart:g,networkPageLoadStart:w,pageNumber:x,random:S,coin:M,muteBi:d(C,"isqa")||d(C,"suppressbi"),sampleRatioState:e.get(C,"query.sampleratio")},deviceType:n.isMobileView?"mobile":"desktop",renderCycle:a&&!p?2:1,renderingEnv:p?"backend":"browser",userWarmup:t.userWarmup,locale:t.rendererModel.locale,sdkSource:n.sdkSource,namespacesSdkSource:n.namespacesSdkSource,externalComponentsSource:n.externalComponentsSource,wixCodeNamespacesAndElementorySupportSource:n.wixCodeNamespacesAndElementorySupportSource,wixCodeViewerAppSource:n.wixCodeViewerAppSource,openExperiments:(A=t.rendererModel.runningExperiments,e.reduce(A,function(e,t,r){return"new"===t&&e.push(r),e},[])),applications:JSON.stringify(U),csrfToken:r.cookieUtils.getCookie("XSRF-TOKEN"),isDebug:n.isDebug};return k=u(t)?e.merge(k,{compId:"wixCode_"+o.appDefinitionId,viewMode:i?"site":"preview"}):e.merge(k,{viewMode:i?"site":t.renderFlags.componentViewMode||"preview"})}function u(t){var r=t.rendererModel.clientSpecMap.toJS?t.rendererModel.clientSpecMap.toJS():t.rendererModel.clientSpecMap;return!!t.rendererModel.wixCodeModel&&e.some(r,{type:"siteextension"})}return{getApi:function(){var e=[],a=[],s=t.messageProxy.get(),d=!1,c=!0,l=null,f=null,m=null,g=void 0,w=void 0;return{init:function(a,c){var l=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};if(!d){l.applications=l.applications||[];var f=l.applications.length>0;if(u(a)){var m=t.specMapUtils.getAppSpec(c),v=n.buildUrl(a,m,l);g=o.getIFrameForApp(v,m),w=p(a,l,m)}else{if(!f)return;var S=n.buildStaticUrl(a,l);g=o.getIFrameForApp(S,{}),w=p(a,l)}var M=function(t,r){var n;o.isIFrameEvent(t,r)&&("PLATFORM_IFRAME"!==(n=r.data).intent&&"WIX_CODE"!==n.intent||"wix_code_iframe_initialized"!==n.type||t.contentWindow.postMessage(i.messageBuilder.setBootstrapParametersMessage(w),"*"),function(e){return("PLATFORM_IFRAME"===e.intent||"WIX_CODE"===e.intent)&&"wix_code_iframe_loaded"===e.type}(r.data)&&s.setMessageHandler(function(e){t.contentWindow.postMessage(e,"*")}),e.forEach(function(e){e(r.data)}))}.bind(null,g);window.addEventListener("message",M,!1),function(e){function t(){var t=window.document.body;t.insertBefore(e,t.firstChild),r.loggingUtils.performance.mark("platform-iframe-added-to-dom")}"loading"!==window.document.readyState?t():window.document.addEventListener("DOMContentLoaded",function(){t()})}(g),d=!0}},destroyAppsContainer:function(){g&&(g.parentNode.removeChild(g),d=!1,s=t.messageProxy.get(),g=void 0)},sendMessage:function(e){e&&s.sendOrHoldMessage(function(e){return a.reduce(function(e,t){return t(e)},e)}(e))},registerMessageHandler:function(t){e.push(t)},registerMessageModifier:function(e){a.push(e)},unregisterMessageHandler:function(t){var r=e.indexOf(t);-1!==r&&e.splice(r,1)},preLoadWidgets:function(e,r){!l&&u(e)&&t.widgetsPreLoader.asyncGetPreLoadMessage(e,r,function(e){c&&!l&&(l=e,s.sendOrHoldMessage(l))})},preLoadUserCode:function(e,r){(!f&&u(e)||t.appsUtils.getAppsBaseInfo({clientSpecMap:e.rendererModel.clientSpecMap,serviceTopology:e.serviceTopology,rendererModel:e.rendererModel}))&&t.widgetsPreLoader.asyncGetPreLoadUserCodeMessage(e,r,function(e){f||(f=e,s.sendOrHoldMessage(f))})},preInitWidgets:function(e,r){!m&&u(e)&&t.widgetsPreLoader.asyncGetPreInitMessage(e,r,function(e){m||(m=e,s.sendOrHoldMessage(m))})},isAppInitiated:function(){return d},getAppsIframe:function(){return g}}}}}.apply(t,n))||(e.exports=o)},1391:function(e,t,r){var n,o;n=[r(1)],void 0===(o=function(e){"use strict";function t(){for(var e=arguments[0],t=1;t<arguments.length;++t)e=e.replace(/\/$/,"")+"/"+arguments[t].replace(/^\//,"");return e}function r(e,t){var r,n=e.serviceTopology,o=(r=e.santaBase,/^https?:\/\/localhost(:[0-9]+)?\/?$/.test(r)||function(e){return/^https?:\/\/s3.amazonaws.com\/integration-tests-statics\/(.+)\/SNAPSHOT\/santa?$/.test(e)}(e.santaBase)?n.scriptsLocationMap.santa:e.santaBase);return o=function(e,t){var r=e.lastIndexOf("/");return/^\d+\.\d+\.\d+$/.test(t)?e.substring(0,r+1)+t:e}(o,t),/(.*\/services\/)?(.*)/.exec(o)[2]}function n(){return e.wSpy.wSpyParam?"?wspy="+e.wSpy.wSpyParam:""}function o(){if("function"!=typeof URLSearchParams&&"undefined"!=typeof window)return!1;var e=void 0;try{e=window.parent.location.search}catch(t){e=""}return(new URLSearchParams(e).get("debug")||"").includes("localWorker")}return{buildUrl:function(e,i){return function(e,n,i,a){if(o())return"//localhost/node_modules/santa-wix-code/"+(i.useWixCodeFallback?"fallback.html":"index.html");var s=a?"pub":"dev",d="//"+n.instanceId+"."+s+".",c=e.serviceTopology.wixCloudBaseDomain,p="node_modules/santa-wix-code/"+(i.useWixCodeFallback?"fallback.html":"index.html");return d+t(c,"_partials",r(e,i.runtimeSource),p)}(e,i,arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},!!e.publicModel)+n()},buildStaticUrl:function(e){return function(e,n){if(o())return"//localhost/node_modules/santa-wix-code/"+(n.useWixCodeFallback?"fallback.html":"index.html");var i=r(e,n.runtimeSource),a="node_modules/santa-wix-code/"+(n.useWixCodeFallback?"fallback.html":"index.html");return t(e.publicModel?"/":"//editor."+e.serviceTopology.serverName+"/","_partials",i,a)}(e,arguments.length>1&&void 0!==arguments[1]?arguments[1]:{})+n()}}}.apply(t,n))||(e.exports=o)},1392:function(e,t,r){var n,o;n=[r(0)],void 0===(o=function(e){"use strict";return{getIFrameForApp:function(t,r){var n=window.document.createElement("iframe");return n.style.cssText="position: fixed; left: 0; right: 0; top: 0; bottom: 0; width: 1px; height: 1px; background: transparent; border: 0",n.tabIndex=-1,n.setAttribute("aria-hidden","true"),n.src=t,e.get(r,"applicationId")&&e.get(r,"appDefinitionId")&&(n.setAttribute("data-app-id",r.applicationId),n.setAttribute("data-app-definition-id",r.appDefinitionId)),n},isIFrameEvent:function(e,t){return t.source===e.contentWindow}}}.apply(t,n))||(e.exports=o)},1393:function(e,t,r){var n,o;n=[r(0),r(34),r(8)],void 0===(o=function(e,t,r){"use strict";return function(n){var o=n.appApi,i=n.siteModel,a=n.isMobileView,s=n.queryUtil,d=n.currentUrl,c=n.isBot,p=!e.isEmpty(s.getParameterByName("debug"));d=d||window.document.location.href;var u,l=t.wixCodeUrlUtils.buildScriptsSources(i.serviceTopology,{isDebug:p}),f=l.sdkSource,m=l.namespacesSdkSource,g=l.externalComponentsSource,w=l.wixCodeNamespacesAndElementorySupportSource,v=l.wixCodeViewerAppSource,S=(b=s.getParameterByName("useWixCodeFallback"),(!r.isOpen("sv_wixCodeForceWorkerForSEO",i)||!window.Worker)&&"false"!==b&&("true"===b||!window.Worker||c)),M={isMobileView:a,sdkSource:f,namespacesSdkSource:m,externalComponentsSource:g,wixCodeNamespacesAndElementorySupportSource:w,wixCodeViewerAppSource:v,runtimeSource:s.getParameterByName("WixCodeRuntimeSource"),ReactSource:s.getParameterByName("ReactSource"),useWixCodeFallback:S,isDebug:p,currentUrl:d},x=s.getParameterByName("viewerPlatformAppSources"),y=s.getParameterByName("controllersUrlOverride");var b;M.applications=t.appsUtils.getAppsBaseInfo({rendererModel:i.rendererModel,clientSpecMap:i.rendererModel.clientSpecMap,serviceTopology:i.serviceTopology,viewerPlatformAppSources:x,currentUrl:d,santaBase:i.santaBase,controllersUrlOverride:y}),u=i.rendererModel.clientSpecMap,o.init(i,u,M),function(e){return t.specMapUtils.getAppSpec(e)||M.applications.length}(u)&&(r.isOpen("sv_moveWixCodeToViewerApp",i)||o.preLoadUserCode(i,d),i.publicModel&&o.preLoadWidgets(i,d))}}.apply(t,n))||(e.exports=o)},34:function(e,t){e.exports=n},65:function(e,t){e.exports=o},8:function(e,t){e.exports=r}})});
//# sourceMappingURL=wixCodeInit.min.js.map